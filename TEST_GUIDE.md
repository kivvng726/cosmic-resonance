# 寰宇回响 - 完整测试指南

## 前置条件检查

### 1. 后端服务状态
- ✅ 后端服务已启动：http://localhost:8000
- ✅ 健康检查通过
- ✅ 月之暗面 API 已配置

### 2. 启动前端服务器

由于前端需要访问后端 API，建议使用本地服务器运行（避免 CORS 问题）。

## 测试步骤

### 方法一：使用 Python 启动前端服务器（推荐）

```bash
# 在项目根目录执行
python -m http.server 8080
```

然后访问：http://localhost:8080

### 方法二：使用 Node.js

```bash
# 在项目根目录执行
npx serve . -p 8080
```

### 方法三：直接打开文件（可能遇到 CORS 问题）

直接双击 `index.html` 文件，但可能无法调用后端 API。

## 完整测试流程

### 1. 启动后端服务（如果还没启动）

```bash
cd backend
python start_server.py
```

后端服务地址：http://localhost:8000

### 2. 启动前端服务器

```bash
# 在项目根目录
python -m http.server 8080
```

前端地址：http://localhost:8080

### 3. 测试步骤

#### 步骤 1: 打开前端页面
- 访问 http://localhost:8080
- 应该看到"寰宇回响"欢迎页面

#### 步骤 2: 测试 3D 星空
- 点击"开始体验"
- 进入 3D 星空场景
- 测试鼠标拖拽、滚轮缩放功能
- 点击星座查看详情

#### 步骤 3: 启动占卜功能
- 在 3D 星空页面，找到并点击"启动占星术"按钮
- 或直接导航到占卜输入页面

#### 步骤 4: 输入占卜信息
- 输入出生日期（例如：1990-01-01）
- 输入占卜问题（例如：我的事业发展如何？）
- 点击"开始占卜"按钮

#### 步骤 5: 观察占卜流程
- 应该看到 4 个步骤的动画：
  1. 连接NASA数据库
  2. 查询紫金山天文台
  3. AI智能分析
  4. 生成专属内容

#### 步骤 6: 查看占卜结果
- 等待流程完成
- 应该看到：
  - 占卜解读文本（Markdown 格式）
  - 行星相位分析
  - 签文诗词
  - 星象插画占位符

#### 步骤 7: 测试其他功能
- 点击"语音播报"按钮（如果可用）
- 点击"分享结果"按钮
- 点击"重新占卜"按钮

## 预期结果

### 成功的情况
1. ✅ 前端页面正常加载
2. ✅ 3D 星空可以交互
3. ✅ 占卜流程正常执行
4. ✅ 后端 API 成功调用
5. ✅ 显示 AI 生成的占卜解读（使用月之暗面 API）
6. ✅ 显示天文数据（星座、月相、逆行等）
7. ✅ 显示传统文化数据（八字、紫微、签文等）

### 如果遇到问题

#### 问题 1: 前端无法连接后端
- **症状**: 占卜结果使用本地模拟数据
- **解决**: 
  - 检查后端服务是否运行：http://localhost:8000/api/health
  - 检查浏览器控制台的错误信息
  - 确认前端 API 地址配置正确

#### 问题 2: CORS 错误
- **症状**: 浏览器控制台显示 CORS 错误
- **解决**: 
  - 确保使用本地服务器运行前端（不要直接打开文件）
  - 检查后端 CORS 配置

#### 问题 3: API 调用失败
- **症状**: 占卜结果使用模拟输出
- **解决**: 
  - 检查 `.env` 文件中的 API Key 是否正确
  - 检查月之暗面账户余额
  - 查看后端日志中的错误信息

#### 问题 4: 占卜结果为空
- **症状**: 显示空白或错误信息
- **解决**: 
  - 检查浏览器控制台错误
  - 检查后端服务日志
  - 确认所有 Agent 都正常执行

## 调试技巧

### 1. 查看浏览器控制台
- 按 F12 打开开发者工具
- 查看 Console 标签页的错误信息
- 查看 Network 标签页的 API 请求

### 2. 查看后端日志
- 后端服务会在控制台输出执行日志
- 查看是否有错误信息

### 3. 测试 API 端点
- 访问 http://localhost:8000/docs
- 在 Swagger UI 中直接测试 `/api/divination/start` 端点
- 查看返回的数据格式

## 快速测试命令

```bash
# 终端 1: 启动后端
cd backend
python start_server.py

# 终端 2: 启动前端
cd ..
python -m http.server 8080
```

然后访问：http://localhost:8080

## 测试检查清单

- [ ] 后端服务正常运行
- [ ] 前端页面正常加载
- [ ] 3D 星空可以交互
- [ ] 占卜输入表单正常
- [ ] 占卜流程动画正常
- [ ] 后端 API 成功调用
- [ ] 占卜结果正常显示
- [ ] 天文数据正确显示
- [ ] 传统文化数据正确显示
- [ ] AI 解读正常生成
- [ ] 其他功能（语音、分享等）正常

